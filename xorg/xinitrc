#!/bin/sh
userresources=$HOME/.Xresources
usermodmap=$HOME/.Xmodmap
sysresources=/etc/X11/xinit/.Xresources
sysmodmap=/etc/X11/xinit/.Xmodmap

# Merge in defaults and keymaps
if [ -f $sysresources ]; then
    xrdb -merge $sysresources
fi

if [ -f $sysmodmap ]; then
    xmodmap $sysmodmap
fi

if [ -f "$userresources" ]; then
    xrdb -merge "$userresources"
fi

if [ -f "$usermodmap" ]; then
    xmodmap "$usermodmap"
fi

# Start some nice programs
if [ -d /etc/X11/xinit/xinitrc.d ] ; then
 for f in /etc/X11/xinit/xinitrc.d/?*.sh ; do
  [ -x "$f" ] && . "$f"
 done
 unset f
fi

# Autostart programs
autostart() {
	variety -n &
	picom --experimental-backends &
	dunst &
	/usr/lib/geoclue-2.0/demos/agent &
	redshift &
	setxkbmap -layout us -variant colemak &
	xsetroot -cursor_name left_ptr &
	xset r rate 300 40 &
	xset r 66 &
	xautolock -time 5 -locker slock &
	xbanish &
	autotiling &
	status &
	if [ "$1" != dwm ]; then
		$HOME/.config/polybar/launch.sh &
	fi
}

# Start random window manager, or the one given if given
if [ "$3" = "" ]; then
	wm=$(shuf -e bspwm dwm | head -n 1)
	export XDG_CURRENT_DESKTOP=$wm
	autostart $wm
	exec $wm
else
	export XDG_CURRENT_DESKTOP=$3
	autostart $3
	exec $3
fi
# "given if given"
